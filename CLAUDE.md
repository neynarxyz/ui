# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the @neynar/ui component library.

## Project Overview

@neynar/ui is a React component library built on **Base UI** (from the MUI team) and **Tailwind CSS v4**. It provides accessible, themeable components for building Neynar applications.

### Key Technologies
- **Base UI** (`@base-ui/react`) - Unstyled, accessible component primitives
- **Tailwind CSS v4** - Utility-first CSS framework
- **class-variance-authority (CVA)** - Variant-based component styling
- **Vite** - Build tool and dev server
- **Storybook 10** - Component development and documentation

## Development Commands

```bash
# Development
yarn dev              # Watch mode for library development
yarn storybook        # Start Storybook on port 6006

# Building
yarn build            # Build the library (generates dist/ and exports)
yarn build-storybook  # Build static Storybook site

# Quality checks
yarn type-check       # TypeScript type checking
yarn lint             # ESLint (use --fix for auto-fixes)
yarn format           # Format code with Prettier
yarn format:check     # Check formatting (CI)
```

## Architecture

### Directory Structure
```
src/
├── components/
│   ├── ui/              # Base UI components (button, dialog, etc.)
│   │   ├── button.tsx
│   │   ├── stories/     # Storybook stories for each component
│   │   │   └── button.stories.tsx
│   │   └── ...
│   └── neynar/          # Neynar-specific components
│       ├── color-mode/  # Color mode system (light/dark/system)
│       ├── first-light/ # First Light theme components
│       └── typography/  # Typography components (Text, Title, etc.)
├── hooks/               # Custom React hooks
├── lib/
│   ├── utils.ts         # Utility functions (cn, etc.)
│   └── variants.ts      # Shared CVA variant definitions
├── styles/
│   ├── styles.css       # Main stylesheet with CSS variables
│   └── themes/          # Theme CSS files
│       ├── purple-dawn.css
│       └── first-light.css
└── index.ts             # Main entry point
```

### Component Pattern

Components follow this structure:

```tsx
"use client";

import { ComponentProps } from "react";
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "base-classes-here",
  {
    variants: {
      variant: {
        default: "variant-classes",
        secondary: "variant-classes",
      },
      size: {
        default: "size-classes",
        sm: "size-classes",
        lg: "size-classes",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

type ButtonProps = ComponentProps<"button"> & VariantProps<typeof buttonVariants>;

function Button({ className, variant, size, ...props }: ButtonProps) {
  return (
    <button
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Button, buttonVariants, type ButtonProps };
```

### Exports System

The package uses per-component exports (not a barrel file):

```tsx
// Consumer imports
import { Button } from "@neynar/ui/button";
import { Dialog } from "@neynar/ui/dialog";
import { useColorMode } from "@neynar/ui/color-mode";
import "@neynar/ui/styles";
```

Exports are auto-generated by `scripts/generate-exports.ts` during build.

## Theming System

### Two Theme Dimensions

1. **Visual Theme** (purple-dawn, first-light) - Controls aesthetics, fonts, borders
2. **Color Mode** (light, dark, system) - Controls light/dark colors

### CSS Variable Structure

```css
/* Base theme variables (in theme CSS files) */
--font-sans: "Figtree Variable", system-ui, sans-serif;
--radius-base: 0.5rem;

/* Color mode variables (light mode default, dark mode override) */
--background: oklch(100% 0 0);
--foreground: oklch(14.9% 0.028 269.08);

.dark {
  --background: oklch(14.9% 0.028 269.08);
  --foreground: oklch(98.5% 0.002 247.86);
}
```

### Color Mode Implementation

The color mode system uses:
- Cookie persistence (`color-mode` cookie)
- `ColorModeInitializer` component for SSR/FOUC prevention
- `useColorMode` hook for runtime control
- Module-level global listener for system preference changes

For Vite/SPA apps, users must add a script to `index.html` manually (see docs).

## TypeScript Rules

### File Naming
- **Always use kebab-case** for file names (e.g., `button-group.tsx`)

### Exports
- **Always use named exports, never default exports**
- Use function declarations, not arrow functions for components

```typescript
// Good
export function Button() {}
export function useColorMode() {}

// Bad
export default function Button() {}
export const Button = () => {}
```

### Component Props
- Extend from `ComponentProps<"element">` for native element props
- Use `VariantProps<typeof variants>` for CVA variants
- Use `type` for component props (e.g., `type ButtonProps = ...`)

## Important Patterns

### The `cn` Utility

Always use `cn()` for className merging:

```tsx
import { cn } from "@/lib/utils";

// Merges classes intelligently, handles Tailwind conflicts
className={cn(baseClasses, conditionalClass && "applied-if-true", className)}
```

### Hydration Safety

For components that differ between server and client (like color mode icons):

```tsx
const [mounted, setMounted] = useState(false);
useEffect(() => setMounted(true), []);

// Use consistent value during SSR
const value = mounted ? clientValue : serverDefault;
```

### Base UI Integration

When wrapping Base UI components:

```tsx
import { Dialog as BaseDialog } from "@base-ui/react/dialog";

export function Dialog({ children, ...props }) {
  return <BaseDialog.Root {...props}>{children}</BaseDialog.Root>;
}

export function DialogTrigger({ className, ...props }) {
  return <BaseDialog.Trigger className={cn("styles", className)} {...props} />;
}
```

## Storybook

### Story Structure

Stories live alongside components in `stories/` subdirectories:

```tsx
import type { Meta, StoryObj } from "@storybook/react";
import { Button } from "../button";

const meta = {
  title: "Components / Core Inputs / Button",
  component: Button,
  parameters: {
    layout: "centered",
  },
} satisfies Meta<typeof Button>;

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: "Button",
  },
};
```

### Theme/Color Mode Testing

Storybook includes toolbar buttons for:
- Switching visual themes (Purple Dawn, First Light)
- Switching color modes (Light, Dark)

## Common Tasks

### Adding a New Component

1. Create `src/components/ui/my-component.tsx`
2. Create `src/components/ui/stories/my-component.stories.tsx`
3. Run `yarn build` to generate exports
4. Component is now importable as `@neynar/ui/my-component`

### Modifying Themes

1. Edit CSS variables in `src/styles/themes/[theme].css`
2. For new variables, add to both theme files
3. Test in Storybook with theme switcher

### Adding Variants

1. Update the CVA definition in the component
2. Add new variant classes
3. Update TypeScript types (automatic with CVA)
4. Add Storybook stories for new variants

## Important Notes

- **Never start dev servers** - The user runs their own
- **Never use React.FC** - Use function declarations with typed props
- **Use 2 spaces for indentation**
- **Prefer editing over creating** - Don't create new files unless necessary
- **No default exports** - Always use named exports
- Build order: The library must be built before consuming apps can use it

## Claude Code Integration

### Slash Commands

| Command | Description |
|---------|-------------|
| `/manage-component` | Document or scaffold components (TSDoc + .llm.md files) |
| `/test-storybook` | Test components in Storybook via Playwright |

### Agents

| Agent | Description |
|-------|-------------|
| `component-manager` | Handles component documentation, scaffolding, and index management |

### LLM Documentation

Component documentation lives in `.llm/`:
- `.llm/components/` - Per-component docs
- `.llm/index.llm.md` - Component index
- `.llm/hooks.llm.md` - Hooks documentation
- `.llm/utilities.llm.md` - Utilities documentation
- `.llm/theming.llm.md` - Theming guide
- `llms.txt` - Entry point for LLM docs

## Peer Dependencies

These are required by consumers but optional for the library:
- `react` / `react-dom` (^19.0.0)
- `date-fns` (^4.0.0) - for Calendar
- `embla-carousel-react` (^8.0.0) - for Carousel
- `input-otp` (^1.0.0) - for InputOTP
- `react-day-picker` (^9.0.0) - for Calendar
- `recharts` (^2.15.0) - for Chart
